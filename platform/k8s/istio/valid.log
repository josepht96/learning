2023-04-08T02:22:01.230298Z	debug	envoy jwt	Called Filter : setDecoderFilterCallbacks
2023-04-08T02:22:01.230364Z	debug	envoy jwt	Called Filter : decodeHeaders
2023-04-08T02:22:01.230371Z	debug	envoy jwt	Prefix requirement '/' matched.
2023-04-08T02:22:01.230376Z	debug	envoy jwt	extract authorizationBearer 
2023-04-08T02:22:01.230382Z	debug	envoy jwt	origins-0: JWT authentication starts (allow_failed=false), tokens size=1
2023-04-08T02:22:01.230385Z	debug	envoy jwt	origins-0: startVerify: tokens size 1
2023-04-08T02:22:01.230388Z	debug	envoy jwt	origins-0: Parse Jwt eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJzbC1WeUFIaWN3WnZfQUo1NjRQQldkdnk4S1EtZm14YkFWNlFWRzJuRXdBIn0.eyJleHAiOjE2ODA5MzgyODcsImlhdCI6MTY4MDkwMjI4NywianRpIjoiM2EwOGRlNWUtMWQ1MS00ZjhhLTk3NGUtOWI2N2Q0N2NkYTU3IiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwMC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjEyNzIzODhiLWQ0MzQtNGM0NS04Zjg1LWNkZWIyNGQzN2RjNCIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIi8qIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJkZWZhdWx0LXJvbGVzLW1hc3RlciIsIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJ0ZXN0Ijp7InJvbGVzIjpbInVtYV9wcm90ZWN0aW9uIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgZW1haWwiLCJjbGllbnRIb3N0IjoiMTcyLjE4LjAuMyIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiY2xpZW50SWQiOiJ0ZXN0IiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LXRlc3QiLCJjbGllbnRBZGRyZXNzIjoiMTcyLjE4LjAuMyJ9.M3FjuhtGj_sQA7ZgeZ_fowZ6pBIgBdaen3JGgsuWUXBN1UjyOAKt6Q5dssg8H5xbGd20ZjmpcJxwjDEeDY-CfV5HnmVH8rnZt5JtE58UYv2z3c5N2BLUIifst6B9ravT79nBzoxQIBWcTcE7IkXCWvY66s6KoSCmXpkYE0_xP0YC4JqTE6Ac4cq8L8CrkDHsB4BPTScH7tUluA4sUSj7QKLFbaWEUCZ6r_jmaPZ7qdcfqQ2JbF16JEqQL7xZL_ufUzmcFwYpATMlwYFbwwjrfaUGkrXpbrkwyhZtgyIpdiy9iX3SUxTPNR2ozeeZ6tydNZLMqApuE2lBl10Wcx4u5A
2023-04-08T02:22:01.230500Z	debug	envoy jwt	origins-0: Verifying JWT token of issuer http://localhost:30000/realms/master
2023-04-08T02:22:01.230509Z	debug	envoy jwt	origins-0: JWT token verification completed with: Jwt issuer is not configured
2023-04-08T02:22:01.230512Z	debug	envoy jwt	Jwt authentication completed with: Jwt issuer is not configured
2023-04-08T02:22:01.230649Z	debug	envoy jwt	Called Filter : onDestroy
2023-04-08T02:22:01.230677Z	debug	envoy jwt	Called Filter : decodeHeaders Stop
2023-04-08T02:22:02.015337Z	debug	envoy jwt	Called Filter : setDecoderFilterCallbacks
2023-04-08T02:22:02.015420Z	debug	envoy jwt	Called Filter : decodeHeaders
2023-04-08T02:22:02.015427Z	debug	envoy jwt	Prefix requirement '/' matched.
2023-04-08T02:22:02.015436Z	debug	envoy jwt	extract authorizationBearer 
2023-04-08T02:22:02.015444Z	debug	envoy jwt	origins-0: JWT authentication starts (allow_failed=false), tokens size=1
2023-04-08T02:22:02.015447Z	debug	envoy jwt	origins-0: startVerify: tokens size 1
2023-04-08T02:22:02.015452Z	debug	envoy jwt	origins-0: Parse Jwt eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJzbC1WeUFIaWN3WnZfQUo1NjRQQldkdnk4S1EtZm14YkFWNlFWRzJuRXdBIn0.eyJleHAiOjE2ODA5MzgyODcsImlhdCI6MTY4MDkwMjI4NywianRpIjoiM2EwOGRlNWUtMWQ1MS00ZjhhLTk3NGUtOWI2N2Q0N2NkYTU3IiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDozMDAwMC9yZWFsbXMvbWFzdGVyIiwiYXVkIjoiYWNjb3VudCIsInN1YiI6IjEyNzIzODhiLWQ0MzQtNGM0NS04Zjg1LWNkZWIyNGQzN2RjNCIsInR5cCI6IkJlYXJlciIsImF6cCI6InRlc3QiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIi8qIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJkZWZhdWx0LXJvbGVzLW1hc3RlciIsIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJ0ZXN0Ijp7InJvbGVzIjpbInVtYV9wcm90ZWN0aW9uIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6InByb2ZpbGUgZW1haWwiLCJjbGllbnRIb3N0IjoiMTcyLjE4LjAuMyIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiY2xpZW50SWQiOiJ0ZXN0IiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LXRlc3QiLCJjbGllbnRBZGRyZXNzIjoiMTcyLjE4LjAuMyJ9.M3FjuhtGj_sQA7ZgeZ_fowZ6pBIgBdaen3JGgsuWUXBN1UjyOAKt6Q5dssg8H5xbGd20ZjmpcJxwjDEeDY-CfV5HnmVH8rnZt5JtE58UYv2z3c5N2BLUIifst6B9ravT79nBzoxQIBWcTcE7IkXCWvY66s6KoSCmXpkYE0_xP0YC4JqTE6Ac4cq8L8CrkDHsB4BPTScH7tUluA4sUSj7QKLFbaWEUCZ6r_jmaPZ7qdcfqQ2JbF16JEqQL7xZL_ufUzmcFwYpATMlwYFbwwjrfaUGkrXpbrkwyhZtgyIpdiy9iX3SUxTPNR2ozeeZ6tydNZLMqApuE2lBl10Wcx4u5A
2023-04-08T02:22:02.015611Z	debug	envoy jwt	origins-0: Verifying JWT token of issuer http://localhost:30000/realms/master
2023-04-08T02:22:02.015702Z	debug	envoy jwt	origins-0: JWT token verification completed with: OK
2023-04-08T02:22:02.015732Z	debug	envoy jwt	Jwt authentication completed with: OK
2023-04-08T02:22:02.016163Z	debug	envoy rbac	checking request: requestedServerName: outbound_.8080_._.nginx.dest.svc.cluster.local, sourceIP: 10.244.1.36:36748, directRemoteIP: 10.244.1.36:36748, remoteIP: 10.244.1.36:36748,localAddress: 10.244.1.38:80, ssl: uriSanPeerCertificate: spiffe://cluster.local/ns/src/sa/default, dnsSanPeerCertificate: , subjectPeerCertificate: , headers: ':authority', 'nginx.dest.svc.cluster.local:8080'
':path', '/'
':method', 'GET'
':scheme', 'http'
'user-agent', 'curl/7.74.0'
'accept', '*/*'
'x-forwarded-proto', 'http'
'x-request-id', 'bd2b82f7-c6db-4a89-bd11-f8693cc735d8'
'x-envoy-attempt-count', '1'
'x-b3-traceid', 'b81868d74a7c576c12ea2cd3cbb1abd7'
'x-b3-spanid', '12ea2cd3cbb1abd7'
'x-b3-sampled', '0'
'x-forwarded-client-cert', 'By=spiffe://cluster.local/ns/dest/sa/default;Hash=c0913e5f9cd119a6ce6489a6e031f30b7da564a27564acc4385f6c7a0e24e31e;Subject="";URI=spiffe://cluster.local/ns/src/sa/default'
, dynamicMetadata: filter_metadata {
  key: "envoy.filters.http.jwt_authn"
  value {
    fields {
      key: "http://localhost:30000/realms/master"
      value {
        struct_value {
          fields {
            key: "acr"
            value {
              string_value: "1"
            }
          }
          fields {
            key: "allowed-origins"
            value {
              list_value {
                values {
                  string_value: "/*"
                }
              }
            }
          }
          fields {
            key: "aud"
            value {
              string_value: "account"
            }
          }
          fields {
            key: "azp"
            value {
              string_value: "test"
            }
          }
          fields {
            key: "clientAddress"
            value {
              string_value: "172.18.0.3"
            }
          }
          fields {
            key: "clientHost"
            value {
              string_value: "172.18.0.3"
            }
          }
          fields {
            key: "clientId"
            value {
              string_value: "test"
            }
          }
          fields {
            key: "email_verified"
            value {
              bool_value: false
            }
          }
          fields {
            key: "exp"
            value {
              number_value: 1680938287
            }
          }
          fields {
            key: "iat"
            value {
              number_value: 1680902287
            }
          }
          fields {
            key: "iss"
            value {
              string_value: "http://localhost:30000/realms/master"
            }
          }
          fields {
            key: "jti"
            value {
              string_value: "3a08de5e-1d51-4f8a-974e-9b67d47cda57"
            }
          }
          fields {
            key: "preferred_username"
            value {
              string_value: "service-account-test"
            }
          }
          fields {
            key: "realm_access"
            value {
              struct_value {
                fields {
                  key: "roles"
                  value {
                    list_value {
                      values {
                        string_value: "default-roles-master"
                      }
                      values {
                        string_value: "offline_access"
                      }
                      values {
                        string_value: "uma_authorization"
                      }
                    }
                  }
                }
              }
            }
          }
          fields {
            key: "resource_access"
            value {
              struct_value {
                fields {
                  key: "account"
                  value {
                    struct_value {
                      fields {
                        key: "roles"
                        value {
                          list_value {
                            values {
                              string_value: "manage-account"
                            }
                            values {
                              string_value: "manage-account-links"
                            }
                            values {
                              string_value: "view-profile"
                            }
                          }
                        }
                      }
                    }
                  }
                }
                fields {
                  key: "test"
                  value {
                    struct_value {
                      fields {
                        key: "roles"
                        value {
                          list_value {
                            values {
                              string_value: "uma_protection"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          fields {
            key: "scope"
            value {
              string_value: "profile email"
            }
          }
          fields {
            key: "sub"
            value {
              string_value: "1272388b-d434-4c45-8f85-cdeb24d37dc4"
            }
          }
          fields {
            key: "typ"
            value {
              string_value: "Bearer"
            }
          }
        }
      }
    }
  }
}
filter_metadata {
  key: "istio_authn"
  value {
    fields {
      key: "request.auth.audiences"
      value {
        string_value: "account"
      }
    }
    fields {
      key: "request.auth.claims"
      value {
        struct_value {
          fields {
            key: "acr"
            value {
              list_value {
                values {
                  string_value: "1"
                }
              }
            }
          }
          fields {
            key: "allowed-origins"
            value {
              list_value {
                values {
                  string_value: "/*"
                }
              }
            }
          }
          fields {
            key: "aud"
            value {
              list_value {
                values {
                  string_value: "account"
                }
              }
            }
          }
          fields {
            key: "azp"
            value {
              list_value {
                values {
                  string_value: "test"
                }
              }
            }
          }
          fields {
            key: "clientAddress"
            value {
              list_value {
                values {
                  string_value: "172.18.0.3"
                }
              }
            }
          }
          fields {
            key: "clientHost"
            value {
              list_value {
                values {
                  string_value: "172.18.0.3"
                }
              }
            }
          }
          fields {
            key: "clientId"
            value {
              list_value {
                values {
                  string_value: "test"
                }
              }
            }
          }
          fields {
            key: "iss"
            value {
              list_value {
                values {
                  string_value: "http://localhost:30000/realms/master"
                }
              }
            }
          }
          fields {
            key: "jti"
            value {
              list_value {
                values {
                  string_value: "3a08de5e-1d51-4f8a-974e-9b67d47cda57"
                }
              }
            }
          }
          fields {
            key: "preferred_username"
            value {
              list_value {
                values {
                  string_value: "service-account-test"
                }
              }
            }
          }
          fields {
            key: "realm_access"
            value {
              struct_value {
                fields {
                  key: "roles"
                  value {
                    list_value {
                      values {
                        string_value: "default-roles-master"
                      }
                      values {
                        string_value: "offline_access"
                      }
                      values {
                        string_value: "uma_authorization"
                      }
                    }
                  }
                }
              }
            }
          }
          fields {
            key: "resource_access"
            value {
              struct_value {
                fields {
                  key: "account"
                  value {
                    struct_value {
                      fields {
                        key: "roles"
                        value {
                          list_value {
                            values {
                              string_value: "manage-account"
                            }
                            values {
                              string_value: "manage-account-links"
                            }
                            values {
                              string_value: "view-profile"
                            }
                          }
                        }
                      }
                    }
                  }
                }
                fields {
                  key: "test"
                  value {
                    struct_value {
                      fields {
                        key: "roles"
                        value {
                          list_value {
                            values {
                              string_value: "uma_protection"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
          fields {
            key: "scope"
            value {
              list_value {
                values {
                  string_value: "profile"
                }
                values {
                  string_value: "email"
                }
              }
            }
          }
          fields {
            key: "sub"
            value {
              list_value {
                values {
                  string_value: "1272388b-d434-4c45-8f85-cdeb24d37dc4"
                }
              }
            }
          }
          fields {
            key: "typ"
            value {
              list_value {
                values {
                  string_value: "Bearer"
                }
              }
            }
          }
        }
      }
    }
    fields {
      key: "request.auth.presenter"
      value {
        string_value: "test"
      }
    }
    fields {
      key: "request.auth.principal"
      value {
        string_value: "http://localhost:30000/realms/master/1272388b-d434-4c45-8f85-cdeb24d37dc4"
      }
    }
    fields {
      key: "request.auth.raw_claims"
      value {
        string_value: "{\"resource_access\":{\"test\":{\"roles\":[\"uma_protection\"]},\"account\":{\"roles\":[\"manage-account\",\"manage-account-links\",\"view-profile\"]}},\"realm_access\":{\"roles\":[\"default-roles-master\",\"offline_access\",\"uma_authorization\"]},\"email_verified\":false,\"clientAddress\":\"172.18.0.3\",\"scope\":\"profile email\",\"preferred_username\":\"service-account-test\",\"iss\":\"http://localhost:30000/realms/master\",\"jti\":\"3a08de5e-1d51-4f8a-974e-9b67d47cda57\",\"clientHost\":\"172.18.0.3\",\"typ\":\"Bearer\",\"exp\":1680938287,\"iat\":1680902287,\"allowed-origins\":[\"/*\"],\"acr\":\"1\",\"clientId\":\"test\",\"azp\":\"test\",\"sub\":\"1272388b-d434-4c45-8f85-cdeb24d37dc4\",\"aud\":\"account\"}"
      }
    }
  }
}

2023-04-08T02:22:02.016228Z	debug	envoy rbac	enforced allowed, matched policy ns[dest]-policy[require-jwt-for-all]-rule[0]
2023-04-08T02:22:02.016763Z	debug	envoy jwt	Called Filter : onDestroy